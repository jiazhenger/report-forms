(this["webpackJsonpreact-report-forms"]=this["webpackJsonpreact-report-forms"]||[]).push([[16,52],{24:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return p}));var n=a(12),r=a(13),i=a(15),l=a(14),o=a(0),c=a.n(o),d=a(43),s=a(57),f=function(t){var e=t.label,a=t.id,n=(t.hasNode,t.onClick);return c.a.createElement("li",{id:a,className:"tap cp h fxmc plr10",onClick:n},c.a.createElement("div",null,c.a.createElement("h3",{className:"f12 tc"},e)))},h=window,m=h.$fn,u=h.$http,p=function(t){Object(i.a)(a,t);var e=Object(l.a)(a);function a(){var t;Object(n.a)(this,a);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return(t=e.call.apply(e,[this].concat(i))).state={},t.getHtml=function(){var e=t.getLastHtml(),a=e.mainHtml,n=e.headerHtml,r=e.footerHtml,i=t.paper,l=parseInt(i.width)+20+"px";return"\n\t\t\t<!DOCTYPE html>\n\t\t\t<html lang='en'>\n\t\t\t<head>\n\t\t\t\t<meta charset='utf-8' />\n\t\t\t\t<meta name='renderer' content='webkit' />\n\t\t\t\t<meta name='viewport' content='width=device-width,user-scalable=no,initial-scale=1.0,shrink-to-fit=no,minimum-scale=1.0,maximum-scale=1.0,minimal-ui,viewport-fit=cover'/>\n\t\t\t\t<title>".concat(i.name,"</title>\n\t\t\t\t<style>\n\t\t\t\t\thtml,body{width:100%;height:100%;font:12px/20px 'Tahoma,Verdana,Arial,sans-serif'; color:#333}\n\t\t\t\t\t*{margin:0;padding:0;box-sizing:border-box}\n\t\t\t\t\timg{border:0;display:block}\n\t\t\t\t\ttable{width:100%;border-collapse:collapse;border-spacing:0}\n\t\t\t\t\t.fxmc{display:flex; align-items: center;justify-content: center}\n\t\t\t\t\tfooter,header,main{position:relative;}\n\t\t\t\t\t.container{position:relative;margin:0 auto;border:1px solid #999;padding:10px}\n\t\t\t\t\t[type='pages']{visibility:hidden}\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t<div class='container' name='").concat(i.name,"' style='width:").concat(l,";min-height:100%;'>\n\t\t\t\t\t").concat(n,"</header>\n\t\t\t\t\t").concat(a,"\n\t\t\t\t\t").concat(r,"\n\t\t\t\t</div>\n\t\t\t\t<script>\n\t\t\t\t\tfunction resize(){\n\t\t\t\t\t\tconst box = document.querySelector('.container');\n\t\t\t\t\t\tbox.style.height = document.body.scrollHeight + 'px'\n\t\t\t\t\t}\n\t\t\t\t\tresize();\n\t\t\t\t\twindow.onresize = resize\n\t\t\t\t<\/script>\n\t\t\t</body>\n\t\t\t</html>\n\t\t")},t.createPdf=function(){if(!t.getLocalHtml())return m.toast("\u65e0\u5185\u5bb9");var e=t.paper,a=t.getLastHtml(!0),n=a.mainHtml,r=a.headerHtml,i=a.footerHtml,l=a.headerHeight,o=a.footerHeight;u.submit(null,"pdf",{param:{header:r,footer:i,headerHeight:l,footerHeight:o,main:n,format:e.format,name:e.name,source:t.getSource(e)}}).then((function(t){m.toast("\u751f\u6210 pdf \u6210\u529f")}))},t.getSource=function(e){var a=m.local("myWidth"),n=m.local("myHeight"),r=t.getLocalHtml(),i=document.createElement("section"),l=document.createElement("div"),o={format:e.format,width:e.width,height:e.height,name:e.name,myWidth:a,myHeight:n};return i.setAttribute("data",JSON.stringify(o)),i.innerHTML=r,l.appendChild(i),l.innerHTML},t.createHtml=function(){var e=t.paper,a=t.getHtml(e);d.default.isString(a)&&(a=a.replace(/[\n\r\t]/g,"")),u.submit(null,"html",{param:{html:a,name:e.name,source:t.getSource(e)}}).then((function(t){m.toast("\u751f\u6210 html \u6210\u529f")}))},t.downloadPdf=function(){window.open(window.$config.api+"downloadPdf?="+t.reportName)},t.downloadHtml=function(){window.open(window.$config.api+"downloadHtml?name"+t.reportName)},t.print=function(){var e=t.__preview.clone();e.finds(".paper-page").removeStyle("marginTop");var a=e.html(),n="\n\t\t    <!DOCTYPE html>\n\t\t    <html lang='en'>\n\t\t    <head>\n\t\t    \t<meta charset='utf-8' />\n\t\t    \t<meta name='renderer' content='webkit' />\n\t\t    \t<meta name='viewport' content='width=device-width,user-scalable=no,initial-scale=1.0,shrink-to-fit=no,minimum-scale=1.0,maximum-scale=1.0,minimal-ui,viewport-fit=cover'/>\n\t\t    \t<title>".concat(t.paper.name,"</title>\n\t\t    \t<style>\n\t\t    \t\thtml,body{width:100%;height:100%;font:12px/20px 'Tahoma,Verdana,Arial,sans-serif'; color:#333}\n\t\t    \t\t*{margin:0;padding:0;box-sizing:border-box}\n\t\t    \t\timg{border:0;display:block}\n\t\t    \t\ttable{width:100%;border-collapse:collapse;border-spacing:0}\n\t\t    \t\t.fxmc{display:flex; align-items: center;justify-content: center}\n\t\t    \t</style>\n\t\t    </head>\n\t\t    <body>\n\t\t        ").concat(a,"\n\t\t    </body>\n\t\t    </html>\n\t\t");Object(d.default)("#iframe").remove();var r=document.createElement("iframe");Object(d.default)(r).id("iframe").cssText("position:absolute;visibility:hidden").appendTo(document.body);var i=r.contentDocument;i.open(),i.write(n),i.close(),r.contentWindow.focus(),r.contentWindow.print()},t}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.html=this.getLocalHtml(),this.paper=m.local("paper"),this.setState({paperWidth:this.paper.width}),this.__preview=Object(d.default)("#preview"),this.preview(),Object(d.default)(document.body).unonce("mouseup")}},{key:"getLocalHtml",value:function(){var t=m.local("html");return t||"<div class='tc g9 pt30'>\u6682\u65e0\u5185\u5bb9</div>"}},{key:"preview",value:function(){var t=this,e=this.getLastHtml(),a=e.mainHtml,n=e.headerHtml,r=e.footerHtml,i=e.headerHeight,l=e.footerHeight,o=parseInt(this.paper.height)-i-l,c=0;!function e(a){var i=document.createElement("div"),l=Object(d.default)(i).addClass("paper-page bcf").style({width:t.paper.width||"810px",height:t.paper.height||"100%",padding:"10px",boxSizing:"content-box"});c>0&&l.style("marginTop","10px"),""!==n&&d.default.toNode(n).children(0).appendTo(i);var s=d.default.toNode(a),f=s.find(".main");f.el?(s.children(0).appendTo(i).style({flex:1}),l.style({display:"flex",flexDirection:"column"})):s.appendTo(i).style({position:"relative"}),""!==r&&d.default.toNode(r).children(0).appendTo(i),t.__preview.append(i);var h=f.el?f:l,m=h.getOffset().offsetTop;c++;var u=h.clone().clear();h.finds(".drag").each((function(t){var a=t.attr("type"),n=t.marginTop();if("table"===a&&t.find(".x-bind-table").el&&t.outerHeight()+n>o){var r=t.clone(),i=r.find("tbody").clear();t.finds("tr").each((function(t,e){var a=t.getInfo();a.offsetTop+a.offsetHeight-m>o&&i.append(t)})),u.append(r),e(u.htmls())}else{var l=t.getInfo();l.offsetTop+l.offsetHeight-m>o+n&&u.append(t),u.children().length()>0&&(u.children(0).removeStyle("marginTop"),e(u.htmls()))}})),Object(d.default)(document).finds(".pageNumber").each((function(t){return t.text(t.parent(".paper-page").index()+1)})),Object(d.default)(document).finds(".totalPages").each((function(e){return e.text(t.__preview.children().length())}))}(a)}},{key:"getData",value:function(t){var e=m.local("dataSource");return s.default.renderData(e.dataSource1,"dataSource1",t,!0),t.html()}},{key:"getLastHtml",value:function(t){var e=d.default.toNode(this.getLocalHtml());this.getData(e);var a=this.paper,n=e.find(".header"),r=e.find(".footer"),i=e.find(".main"),l=0,o=0,c=0,s="",f=e.html(),h="";return e.finds("table").each((function(t){var e=t.parents(".drag");e.attr("rootUrl")&&e.removeStyle("height")})),n.el&&(n.style("position","relative").removeStyle("left,top,marginTop,marginBottom"),l=n.height(),t&&n.width(a.width).style("transform","scale(".concat(.713,")")),s=n.htmls()),r.el&&(r.style("position","relative").removeStyle("left,top,marginTop,marginBottom"),o=r.height(),t&&(o=.713*r.height(),r.width(a.width).style("transform","scale(".concat(.713,")"))),h=r.htmls()),i.el?(i.style("position","relative").removeStyle("height,left,top,marginTop,marginBottom"),c=i.height(),f=i.htmls()):(r.el||n.el)&&(f=""),{mainHtml:f,headerHtml:s,footerHtml:h,headerHeight:l,footerHeight:o,mainHeight:c}}},{key:"render",value:function(){return c.a.createElement("div",{className:"wh fv"},c.a.createElement("header",{className:"fxm plr10 bcf bbor1 nosel",style:{height:"30px"}},c.a.createElement("div",{className:"ex h"},c.a.createElement("ul",{className:"fxmc h"},c.a.createElement(f,{label:"\u751f\u6210 html",onClick:this.createHtml}),c.a.createElement(f,{label:"\u751f\u6210 pdf",onClick:this.createPdf}),c.a.createElement(f,{label:"\u4e0b\u8f7d pdf",onClick:this.downloadPdf}),c.a.createElement(f,{label:"\u4e0b\u8f7d html",onClick:this.downloadHtml}),c.a.createElement(f,{label:"\u6253\u5370",onClick:this.print})))),c.a.createElement("div",{className:"ex rel",style:{margin:"5px"}},c.a.createElement("div",{className:"abs_full scroll fxc f12 lh20"},c.a.createElement("div",{id:"preview"}))))}}]),a}(c.a.Component)},57:function(t,e,a){"use strict";a.r(e);var n=a(5),r=a(7),i=a(44),l=a(43),o=a(48),c=a(45),d=window.$fn;e.default={formatData:function(t,e,a,n){var i=this,l=0;return function t(o,c,s){s=s||e;var f=!1;return 0===l&&(f=!!d.hasArray(o)&&"/0",l++),o=d.hasArray(o)?o[0]:o,d.hasObject(o)&&Object.keys(o).forEach((function(l,h){var m=d.hasArray(o[l])?"/0":"",u=f?s+f+"/"+l+m:s+"/"+l+m,p={name:l,url:u,root:e,checked:a===u};p.parentUrl=i.getParentUrl(u),c[h]="object"===typeof o[l]?Object(r.a)(Object(r.a)({},p),{},{children:[]}):Object(r.a)(Object(r.a)({},p),{},{value:o[l],isString:1}),"table"===n||("ul"===n?"object"!==typeof o[l]&&(c[h].disabled=!0):("object"===typeof o[l]&&(c[h].disabled=!0),i.isArray(u)&&(c[h].disabled=!0))),"object"===typeof o[l]&&(d.isArray(o[l])?c[h].isArray=1:d.isObject(o[l])&&(c[h].isObject=1),t(o[l],c[h].children,u))})),c}(t,[])},formatCheckedData:function(t,e,a){return function t(e,n){return e.forEach((function(e,r){e.url===n?e.checked=1:e.checked=0,d.hasArray(e.children)&&(a&&(e.disabled=!0),t(e.children,n))})),e}(t,e.url)},getField:function(t){return"string"===typeof t?t.split("/"):null},getData:function(t,e){if("string"===typeof e){var a=e.split("/"),n=t;return a.forEach((function(t){n=n[t]})),n}return null},parse:function(t,e){if("string"===typeof e){var a=e.split("/");isNaN(+a[a.length-1])||a.pop();for(var n=0;n<a.length;){var r=a[n];r=isNaN(+r)?r:+r,"object"===typeof t&&(t=t[r]),n++}return t}return null},parseParent:function(t,e){if("string"===typeof e){var a=e.split("/");(a=a.filter((function(t){return isNaN(+t)}))).shift(),a.pop();for(var n=0;n<a.length;){t=t[a[n]]||{},n++}return t}return{}},isArray:function(t){var e=t.split("/"),a=e.length;return!isNaN(e[a-1])},isArrayChild:function(t){var e=t.split("/"),a=e.length;return!isNaN(e[a-2])},getParentUrl:function(t){if(l.default.isString(t)){var e=t.split("/");return this.isArray(t)?(e=e.filter((function(t){return isNaN(+t)}))).pop():e.pop(),e.join("/")}return""},getUrlField:function(t){if(l.default.isString(t)){var e=t.split("/");return e[e.length-1]}return""},getRootUrl:function(t){return l.default.isString(t)?t.split("/")[0]:""},getUrlData:function(t,e){var a=Object(r.a)({rootUrl:null,data:[],callback:null},e),i=a.rootUrl,o=a.data,c=t.attr("url");if(l.default.isString(c)){var d=c.split("/");d[0]=i,c=d.join("/"),t.attr({url:c});var s=this.parse(Object(n.a)({},i,o),this.getParentUrl(c)),f=this.parse(Object(n.a)({},i,o),c);(l.default.hasArray(s)||l.default.hasObject(s))&&a.callback&&a.callback(f,s,c)}},isContent:function(t){return 0===t.finds("code").length()},renderData:function(t,e,a,n){var r=this;return a.finds(".x-bind-url").each((function(a){r.getUrlData(a,{data:t,rootUrl:e,callback:function(t,e,l){var o=a.attr("type");"text"===o?n?a.text(t):a.html(i.default.bindField(r.getUrlField(l))):"img"===o?a.find("img").src(t):"barcode"===o?i.default.createBarcode(a,t):"qrcode"===o?i.default.createQrcode(a,t):"checkbox"===o&&i.default.createCheckbox(a,t)}})})),a.finds("table").each((function(a){if(0!==a.finds(".x-bind-table").length()||0!==a.finds("code").length()){a.parent(".drag").removeStyle("height");var d=a.find("tbody"),s=[];d.finds("td").each((function(t){t.attr("url")&&s.push(t.attr("url"))})),r.getUrlData(d.find("td"),{data:t,rootUrl:e,isParent:!0,callback:function(t,e,r){var i=d.find("tr").children().length(),s=d.children().length();if(l.default.hasArray(e)){var f=n?e.length:1,h=c.tableConfig.style;if(0===+a.attr("border")&&delete h.border,f!==s){var m=o.default.createTbody({row:f,col:i,td:{style:h,className:"loopNode x-bind-table",attr:{type:"text"}}});d.html(m.innerHTML)}}}}),d.finds("tr").each((function(a,l){a.children().each((function(a,o){a.hasClass("x-bind-table")&&(a.attr("url",s[o]),r.getUrlData(a,{data:t,rootUrl:e,callback:function(t,e,o){var c=r.getUrlField(o);if(n){var d=e[l];d&&a.text(d[c])}else a.html(i.default.bindField(c))}}))}))}))}})),a.finds(".drag").each((function(t){t.attr("rootUrl")&&t.attr({rootUrl:e})})),a}}}}]);